pipeline {
    agent any

    environment {
        SONAR_SCANNER_HOME = tool 'SonarScanner'  // Deve corresponder à configuração global da ferramenta
        PATH = "${env.PATH};C:/Program Files/dotnet"  // Atualiza com o caminho correto do .NET SDK
    }

    stages {
        stage('Verificar Instalação do .NET') {
            steps {
                echo 'Verificando a instalação do .NET SDK...'
                bat 'dotnet --info'  // Verifica se a CLI do .NET está a funcionar
            }
        }

        stage('Checkout') {
            steps {
                echo 'A fazer checkout do repositório...'
                git branch: 'develop', url: 'https://github.com/BytesNortenhos/ctesp2425-final-gAf.git'
            }
        }

        stage('Restaurar Dependências') {
            steps {
                echo 'A restaurar as dependências...'
                dir('ctesp2425-final-gAf') {  // Substitui com o caminho correto do teu projeto ou ficheiro de solução
                    bat 'dotnet restore'  // Restaura as dependências
                }
            }
        }

        stage('Compilar') {
            steps {
                echo 'A compilar o projeto...'
                dir('ctesp2425-final-gAf') {  // Garante que estás no diretório correto
                    bat 'dotnet build --configuration Release'  // Compila o projeto
                }
            }
        }

        stage('Testar') {
            steps {
                echo 'A executar os testes...'
                dir('ctesp2425-final-gAf') {  // Garante que estás no diretório correto
                    bat 'dotnet test --configuration Release'  // Executa os testes
                }
            }
        }
        
        stage('Publicar') {
            steps {
                echo 'A publicar o projeto...'
                dir('ctesp2425-final-gAf') {  // Garante que estás no diretório correto
                    bat 'dotnet publish --configuration Release --output ./publish'  // Publica o projeto
                }
            }
        }
    }

    post {
        success {
            echo 'Pipeline concluído com sucesso!'
        }
        failure {
            echo 'Pipeline falhou!'
        }
    }}